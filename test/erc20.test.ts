import {utils} from "ethers";
import {Abi} from "../src/chain/abis";
import {ApiManager} from "../src/chain/api"
import axios from "axios";

process.env.VUE_APP_CHAIN_URL = "https://dreamd.rennbon.online:8545"
process.env.VUE_APP_DREAM_TOKEN = "0x5045765ebFa7C5018CEfe2484559Fb985520F9a6"
process.env.VUE_APP_DREAM_MAKE = "0xD9CB119c380b16e64AE8762f0F5F987f789b58a5"
process.env.VUE_APP_CHAIN_ID = "999"

jest.mock('axios')
const mockedAxios = axios as jest.Mocked<typeof axios>;


/*
let cm = new erc20.ContractManager()
test('viewTotalAmount', async () => {
    let result = await cm.ViewTotalAmount()
    console.log(result)
});

test("withdraw", async () => {
    let result = await cm.Withdraw('0x300B0975B6F277515AD7a7B32a1eC2da1bE27F7B', '1.00')
    console.log(result)
});
*/

test("GetEstimateGas", async () => {
    let
        tx = {
            from: "0x519c668a1b0850b3C1Faf5344EbfA98ea98B8C2a",
            to: "0xD9CB119c380b16e64AE8762f0F5F987f789b58a5",
            nonce: "0x12",
            gasPrice: "0x3b9aca00",
            gasLimit: "0x07a120",
            value: "0x0",
            data: "0xe806cc91000000000000000000000000a333ebfb25463ac0a85c54136f7c3b103d239ee100000000000000000000000000000000000000000000000010a741a46278000000000000000000000000000000000000000000000000000ad78ebc5ac6200000000000000000000000000000000000000000000000000015af1d78b58c4000000000000000000000000000000000000000000000000000001bc16d674ec80000000000000000000000000000000000000000000000000000000000000000c35000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000",
            gas: "0x0"
        }
    const response = await ApiManager.GetEstimateGas(tx)
    console.log(response)
})

test("blockHeight", async () => {
    ApiManager.GetBlockNumber().then(
        res => {
            console.log(res)
        }
    ).catch(err => {
        console.log(err)
    })

})
test("decode", () => {

    ///////////0xe806cc91000000000000000000000000e5f363225de283e70b715ebeafad3d96a5dac99400000000000000000000000000000000000000000000000010a741a462780000000000000000000000000000000000000000000000000001158e460913d000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000001bc16d674ec80000000000000000000000000000000000000000000000000000000000000000138800000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f2e7777772e676f6f676c652e636f6d0000000000000000000000000000000000
    ///////////0xe806cc910000000000000000000000006db9a1a6663910323c4f587bd566b0a9b9ea10b600000000000000000000000000000000000000000000000010a741a462780000000000000000000000000000000000000000000000000001158e460913d000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000001bc16d674ec80000000000000000000000000000000000000000000000000000000000000000138800000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000
    let hex = "0xe806cc91000000000000000000000000e5f363225de283e70b715ebeafad3d96a5dac99400000000000000000000000000000000000000000000000010a741a462780000000000000000000000000000000000000000000000000001158e460913d000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000001bc16d674ec80000000000000000000000000000000000000000000000000000000000000000138800000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f2e7777772e676f6f676c652e636f6d0000000000000000000000000000000000"
    let he0 = "0xe806cc91000000000000000000000000e5f363225de283e70b715ebeafad3d96a5dac99400000000000000000000000000000000000000000000000010a741a462780000000000000000000000000000000000000000000000000001158e460913d000000000000000000000000000000000000000000000000000022b1c8c1227a000000000000000000000000000000000000000000000000000001bc16d674ec80000000000000000000000000000000000000000000000000000000000000000138800000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e7777772e676f6f676c652e636f6d000000000000000000000000000000000000"
    let abi = new utils.Interface(Abi.DreamMake)
    const input1 = "0xE5f363225dE283e70b715ebEaFAD3d96A5daC994"
    const input2 = utils.parseEther("1.2")
    const input3 = utils.parseEther("20")
    const input4 = utils.parseEther("40")
    const input5 = utils.parseEther("2")
    const input6 = "5000"
    const input7 = ["www.google.com", "www.google.com"]

    const data = abi.encodeFunctionData("setProject", [input1, input2, input3, input4, input5, input6, input7])
    console.log(data)
    if (data === hex) {
        console.log("success")
    }
    if (data === he0) {
        console.log("failed")
    }
    expect(data).toBe(hex)
})
